{% extends "base.html" %}
{% set title = "Discover Channels" %}
{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-end gap-3 mb-3">
  <div>
    <h1 class="h3 mb-1">Discover Channels</h1>
    <p class="text-muted mb-0">Browse public channels by rank or search by name / slug. Rank is a rolling activity score (higher is more active).</p>
  </div>
</div>

<form
  method="get"
  class="row g-2 align-items-end mb-4"
  hx-get="/channels/discover"
  hx-trigger="keyup changed delay:300ms from:#channel-search, search from:#channel-search, change from:#channel-sort, change from:#has-upcoming, change from:#invert-sort, submit"
  hx-target="#channels-results"
  hx-swap="innerHTML"
  hx-indicator="#channels-search-indicator"
  hx-sync="this:abort"
>
  <div class="col-md-6">
    <label class="form-label" for="channel-search">Search</label>
    <input
      id="channel-search"
      class="form-control"
      type="search"
      name="q"
      placeholder="Search channels (e.g., “cigar”, “poker-night”)"
      value="{{ query }}"
      autocomplete="off"
    >
  </div>
  <div class="col-md-3">
    <label class="form-label" for="channel-sort">Sort</label>
    <select id="channel-sort" name="sort" class="form-select">
      <option value="rank" {% if sort == "rank" %}selected{% endif %}>Rank</option>
      <option value="name" {% if sort == "name" %}selected{% endif %}>Name</option>
      <option value="recent" {% if sort == "recent" %}selected{% endif %}>Recently used</option>
    </select>
  </div>
  <div class="col-md-3">
    <div class="form-check mt-4">
      <input
        id="has-upcoming"
        class="form-check-input"
        type="checkbox"
        name="has_upcoming"
        value="true"
        {% if has_upcoming %}checked{% endif %}
      >
      <label class="form-check-label" for="has-upcoming">Only channels with upcoming events</label>
    </div>
    <div class="form-check mt-2">
      <input
        id="invert-sort"
        class="form-check-input"
        type="checkbox"
        name="invert"
        value="true"
        {% if invert %}checked{% endif %}
      >
      <label class="form-check-label" for="invert-sort">Invert sort</label>
    </div>
  </div>
  <div class="col-12 d-flex flex-wrap gap-2">
    <button class="btn btn-primary" type="submit">Search</button>
    <div id="channels-search-indicator" class="htmx-indicator spinner-border spinner-border-sm text-primary align-self-center" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <span class="text-muted small align-self-center">Updates as you type.</span>
    {% if query or sort != "rank" or has_upcoming or invert %}
      <a class="btn btn-outline-secondary" href="/channels/discover">Clear</a>
    {% endif %}
  </div>
</form>

<div id="channels-results">
  {% include "partials/discover_channels_results.html" %}
</div>
{% endblock %}
