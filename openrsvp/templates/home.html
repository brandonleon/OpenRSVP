{% extends "base.html" %}
{% set title = "Home" %}
{% block content %}
<section class="hero-panel p-4 p-md-5 rounded-4 text-white mb-4">
  <div class="row align-items-center g-4 flex-lg-nowrap">
    <div class="col-lg-7">
      <p class="text-uppercase small mb-2 fw-semibold text-secondary" style="letter-spacing: 0.08em;">Privacy-first RSVPs</p>
      <h1 class="display-6 fw-semibold mb-3">OpenRSVP is a modern, accountless way to gather people.</h1>
      <p class="mb-4 lead text-secondary">Built for small communities and pop-up events. Every capability is a single magic link, and stale data quietly decays on its own.</p>
      <div class="d-flex flex-wrap gap-2">
        <span class="badge bg-light text-dark">No accounts or tracking</span>
        <span class="badge bg-light text-dark">Magic-link admin + guest tokens</span>
        <span class="badge bg-light text-dark">Automatic decay & cleanup</span>
      </div>
    </div>
    <div class="col-lg-5">
      <div class="bg-dark border border-secondary rounded-3 p-4 h-100">
        <h2 class="h5 text-white mb-3">Why hosts use OpenRSVP</h2>
        <ul class="text-secondary small ps-3 mb-4">
          <li>Share a single link with your group—no logins, emails, or tracking pixels.</li>
          <li>Guests control their own RSVP; event owners cannot edit names or notes.</li>
          <li>Events, RSVPs, and channels decay over time to reduce data footprint.</li>
        </ul>
        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-primary" href="/event/create">Create an event</a>
          <a class="btn btn-outline-light" href="/help">See how it works</a>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="p-3 bg-white shadow-sm border rounded-3 h-100">
      <h3 class="h6 text-uppercase text-muted mb-2">Accountless</h3>
      <p class="mb-0 text-secondary">Every action is gated by a capability token. No login walls, no stored emails.</p>
    </div>
  </div>
  <div class="col-md-4">
    <div class="p-3 bg-white shadow-sm border rounded-3 h-100">
      <h3 class="h6 text-uppercase text-muted mb-2">Privacy-forward</h3>
      <p class="mb-0 text-secondary">We collect only names, pronouns, RSVP status, guest count, and notes—nothing else.</p>
    </div>
  </div>
  <div class="col-md-4">
    <div class="p-3 bg-white shadow-sm border rounded-3 h-100">
      <h3 class="h6 text-uppercase text-muted mb-2">Ephemeral by design</h3>
      <p class="mb-0 text-secondary">Channels and events decay automatically; stale data fades without manual clean up.</p>
    </div>
  </div>
</div>

<div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3">
  <div>
    <h2 class="h4 mb-1">Upcoming Events</h2>
    <p class="text-muted mb-0">Soonest first · {{ upcoming_pagination.total_events }} total</p>
  </div>
  <div class="d-flex flex-wrap gap-2 align-items-center">
    <form class="d-flex flex-wrap gap-2 align-items-center" method="get">
      <label class="form-label mb-0 text-uppercase small fw-semibold">Jump to channel</label>
      <select name="channel" class="form-select form-select-sm" style="min-width: 220px;">
        <option value="">All public channels</option>
        {% for channel in public_channels %}
        <option value="{{ channel.slug }}">{{ channel.name }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-outline-secondary btn-sm" type="submit">View</button>
    </form>
    <a class="btn btn-outline-secondary btn-sm" href="/channels/discover">Discover Channels</a>
    <a class="btn btn-primary" href="/event/create">Create New Event</a>
  </div>
</div>

{% if upcoming_events %}
  <div class="list-group shadow-sm">
  {% for event in upcoming_events %}
    <a href="/e/{{ event.id }}" class="list-group-item list-group-item-action py-3">
      <div class="d-flex w-100 justify-content-between align-items-center flex-wrap gap-2">
        <div>
          <h5 class="mb-1">{{ event.title }}</h5>
          <small class="text-muted">{{ list_location_text(event) }}</small>
          {% if event.rsvps_closed %}
          <div class="mt-1"><span class="badge bg-danger text-uppercase">RSVPs closed</span></div>
          {% elif event.rsvp_close_at %}
          <div class="mt-1"><span class="badge bg-info text-dark text-uppercase">Auto closes {{ event.rsvp_close_at|relative_time }}</span></div>
          {% endif %}
        </div>
        <div
          class="text-end js-event-time"
          data-event-utc="{{ event.start_time.isoformat(timespec='seconds') }}Z"
        >
          <span class="badge bg-light text-dark js-event-absolute">{{ event.start_time.strftime('%Y-%m-%d %H:%M') }}</span>
          <div class="text-muted small js-event-relative" data-placeholder="Calculating...">{{ event.start_time|relative_time }}</div>
          {% if event.end_time %}
          <div class="text-muted small">Duration: {{ event.start_time|duration(event.end_time) }}</div>
          {% endif %}
        </div>
      </div>
      <div class="mb-0 mt-2 text-muted small markdown-content">{{ (event.description or 'No description provided.') | markdown | safe }}</div>
    </a>
  {% endfor %}
  </div>
{% else %}
  <div class="p-4 bg-white border rounded-3 shadow-sm">
    <div class="d-flex align-items-start gap-3 flex-wrap">
      <div class="flex-grow-1">
        <h3 class="h5 mb-2">No upcoming events right now.</h3>
        <p class="text-muted mb-3">Be the first to post something for your crew. OpenRSVP works great for pop-up meetups, cigar socials, or tight-knit community hangs where privacy matters.</p>
        <ul class="text-muted small ps-3 mb-3">
          <li>Host link stays private to you; guests manage their own RSVP.</li>
          <li>Public channels for discovery; private slugs when you only invite who you trust.</li>
          <li>Magic links only—no accounts, analytics, or email collection.</li>
        </ul>
        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-primary" href="/event/create">Create your first event</a>
          <a class="btn btn-outline-secondary" href="/help">Learn the privacy model</a>
        </div>
      </div>
    </div>
  </div>
{% endif %}

{% if upcoming_pagination.total_pages > 1 %}
<nav class="mt-4" aria-label="Event pagination">
  <ul class="pagination mb-0">
    <li class="page-item {% if not upcoming_pagination.has_prev %}disabled{% endif %}">
      <a class="page-link" href="?page={{ upcoming_pagination.prev_page or upcoming_pagination.page }}">Previous</a>
    </li>
    <li class="page-item disabled">
      <span class="page-link">Page {{ upcoming_pagination.page }} of {{ upcoming_pagination.total_pages }}</span>
    </li>
    <li class="page-item {% if not upcoming_pagination.has_next %}disabled{% endif %}">
      <a class="page-link" href="?page={{ upcoming_pagination.next_page or upcoming_pagination.page }}">Next</a>
    </li>
  </ul>
</nav>
{% endif %}

{% if recent_events %}
<div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mt-5 mb-3">
  <div>
    <h3 class="h5 mb-1">Recently happened</h3>
    <p class="text-muted mb-0">Most recent first · showing up to {{ recent_limit }} still-visible events</p>
  </div>
</div>
<div class="list-group shadow-sm">
{% for event in recent_events %}
  <a href="/e/{{ event.id }}" class="list-group-item list-group-item-action py-3">
    <div class="d-flex w-100 justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <h5 class="mb-1">{{ event.title }}</h5>
        <small class="text-muted">{{ list_location_text(event) }}</small>
        {% if event.rsvps_closed %}
        <div class="mt-1"><span class="badge bg-danger text-uppercase">RSVPs closed</span></div>
        {% elif event.rsvp_close_at %}
        <div class="mt-1"><span class="badge bg-info text-dark text-uppercase">Auto closes {{ event.rsvp_close_at|relative_time }}</span></div>
        {% endif %}
      </div>
      <div
        class="text-end js-event-time"
        data-event-utc="{{ event.start_time.isoformat(timespec='seconds') }}Z"
      >
        <span class="badge bg-light text-dark js-event-absolute">{{ event.start_time.strftime('%Y-%m-%d %H:%M') }}</span>
        <div class="text-muted small js-event-relative" data-placeholder="Calculating...">{{ event.start_time|relative_time }}</div>
        {% if event.end_time %}
        <div class="text-muted small">Duration: {{ event.start_time|duration(event.end_time) }}</div>
        {% endif %}
      </div>
    </div>
    <div class="mb-0 mt-2 text-muted small markdown-content">{{ (event.description or 'No description provided.') | markdown | safe }}</div>
  </a>
{% endfor %}
</div>
{% endif %}
{% endblock %}
